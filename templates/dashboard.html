<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZJUers æ¨¡æ‹Ÿå™¨ - æ¸¸æˆè¿›è¡Œä¸­</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link href="/static/css/style.css" rel="stylesheet">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon/favicon-16x16.png">
    <link rel="icon" href="/static/favicon/favicon.ico">
    <link rel="manifest" href="/static/favicon/site.webmanifest">
    <style>
        /* å±€éƒ¨æ ·å¼è°ƒæ•´ */
        .event-log {
            overflow-y: auto;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            font-family: 'Courier New', Courier, monospace;
        }

        .stat-label {
            font-size: 0.85rem;
            color: #666;
        }

        .bg-light-danger {
            background-color: #fff5f5;
        }

        /* é’‰é’‰æ¶ˆæ¯æ°”æ³¡æ ·å¼åŸºç¡€ */
        .ding-msg-item {
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .ding-avatar {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            background: #0089FF;
            color: white;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            margin-right: 8px;
        }
    </style>
</head>

<body>

    <nav class="navbar navbar-dark bg-primary mb-4">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">ZJUers Simulator</span>
            <div class="text-white d-flex align-items-center" id="user-info">
                <span id="display-name">Loading...</span> |
                <span id="display-major" class="badge bg-warning text-dark">...</span> |
                <span id="display-semester">å¤§ä¸€ç§‹å†¬</span>
                <div class="ms-3">
                    <button class="btn btn-sm btn-outline-light me-2" onclick="saveGame()" title="æ‰‹åŠ¨ä¿å­˜æ¸¸æˆ">
                        <i class="bi bi-save"></i> ä¿å­˜
                    </button>
                    <button class="btn btn-sm btn-danger" onclick="showExitConfirm()" title="é€€å‡ºæ¸¸æˆ">
                        <i class="bi bi-box-arrow-right"></i> é€€å‡º
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <div class="container-fluid px-4">
        <div class="row">
            <div class="col-md-3">
                <div class="card mb-3">
                    <div class="card-header bg-info text-white">ğŸ“š å­¦åœ¨æŠ˜å¤§</div>
                    <div class="card-body p-2">
                        <div id="course-list" class="list-group list-group-flush">
                            <div class="text-center text-muted py-3">åŠ è½½ä¸­...</div>
                        </div>
                    </div>
                </div>
                <div class="card mb-3">
                    <div class="card-body text-center p-2">
                        <h6 class="card-title mb-1">å½“å‰GPA</h6>
                        <h2 class="display-6 text-primary mb-0" id="gpa-display">0.0</h2>
                    </div>
                </div>
            </div>

            <div class="col-md-6">

                <div class="card mb-3">
                    <div class="card-header">ğŸ“… æ±‚æ˜¯å›­åŠ¨æ€</div>
                    <div class="card-body p-0">
                        <div id="event-log" class="event-log border-0" style="height: 255px;">
                            <div class="text-muted p-2">è¿æ¥åˆ°æŠ˜å¤§æœåŠ¡å™¨ä¸­...</div>
                        </div>
                    </div>
                    <div class="card-footer py-1">
                        <div class="d-flex justify-content-end">
                            <button class="btn btn-link btn-sm text-decoration-none text-secondary"
                                onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
                        </div>
                    </div>
                </div>

                <div class="card mb-3" id="ding-panel">
                    <div class="card-header bg-light border-bottom d-flex justify-content-between align-items-center">
                        <span>ğŸ’¬ é’‰é’‰ (DingTalk)</span>
                        <span class="badge bg-danger rounded-pill" id="ding-unread" style="display:none">0</span>
                    </div>
                    <div class="card-body p-0" style="height: 200px; overflow-y: auto; background: #f7faff;">
                        <div id="ding-messages" class="p-3">
                            <div class="text-center text-muted small mt-4">
                                <p>æš‚æ— æ–°æ¶ˆæ¯</p>
                                <p>ç­çº§ç¾¤é€šçŸ¥ã€è¾…å¯¼å‘˜ç§ä¿¡å°†åœ¨è¿™é‡Œæ˜¾ç¤º</p>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer bg-white border-top p-2">
                        <form id="ding-form" class="d-flex gap-2" onsubmit="return false;">
                            <input type="text" id="ding-input" class="form-control form-control-sm"
                                placeholder="å›å¤æ¶ˆæ¯... (åŠŸèƒ½å¼€å‘ä¸­)" disabled>
                            <button class="btn btn-primary btn-sm" type="submit" disabled>å‘é€</button>
                        </form>
                    </div>
                    <div class="d-flex flex-column gap-2 py-3 px-3">
                        <button id="pause-resume-btn" class="btn btn-outline-danger" onclick="sendAction('pause')">â¸ï¸
                            æš‚åœæ¸¸æˆ</button>

                        <!-- é€Ÿåº¦æ§åˆ¶ -->
                        <div class="btn-group" role="group" aria-label="æ¸¸æˆé€Ÿåº¦">
                            <button type="button" class="btn btn-sm btn-outline-secondary active"
                                onclick="setGameSpeed(1.0)" id="speed-1.0">1x</button>
                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="setGameSpeed(1.5)"
                                id="speed-1.5">1.5x</button>
                            <button type="button" class="btn btn-sm btn-outline-secondary" onclick="setGameSpeed(2.0)"
                                id="speed-2.0">2x</button>
                        </div>
                        <small class="text-muted text-center">âš¡ æ¸¸æˆé€Ÿåº¦</small>

                        <script>window.addEventListener('DOMContentLoaded', function () { if (window.updatePauseButton) updatePauseButton(); });</script>
                    </div>
                </div>
            </div>

            <div class="col-md-3">
                <div class="accordion" id="rightPanelAccordion">
                    <!-- ä¸ªäººçŠ¶æ€é¢æ¿ -->
                    <div class="accordion-item border-0 mb-2">
                        <h2 class="accordion-header" id="headingStats">
                            <button class="accordion-button bg-success text-white py-2" type="button"
                                data-bs-toggle="collapse" data-bs-target="#collapseStats" aria-expanded="true"
                                aria-controls="collapseStats">
                                <strong>ğŸ“Š ä¸ªäººçŠ¶æ€</strong>
                            </button>
                        </h2>
                        <div id="collapseStats" class="accordion-collapse collapse show" aria-labelledby="headingStats">
                            <div class="accordion-body p-3">
                                <div class="mb-2">
                                    <div class="d-flex justify-content-between stat-label mb-1">
                                        <span class="small">ç²¾åŠ›</span> <span id="val-energy"
                                            class="small fw-bold">100/100</span>
                                    </div>
                                    <div class="progress" style="height: 8px;">
                                        <div id="bar-energy" class="progress-bar bg-success" style="width: 100%"></div>
                                    </div>
                                </div>

                                <div class="mb-2">
                                    <div class="d-flex justify-content-between stat-label mb-1">
                                        <span class="small">å¿ƒæ€</span> <span id="val-sanity"
                                            class="small fw-bold">50/100</span>
                                    </div>
                                    <div class="progress" style="height: 8px;">
                                        <div id="bar-sanity" class="progress-bar bg-info" style="width: 50%"></div>
                                    </div>
                                </div>

                                <div class="mb-2">
                                    <div class="d-flex justify-content-between stat-label mb-1">
                                        <span class="small">å‹åŠ›</span> <span id="val-stress"
                                            class="small fw-bold">0/100</span>
                                    </div>
                                    <div class="progress" style="height: 8px;">
                                        <div id="bar-stress" class="progress-bar bg-danger" style="width: 0%"></div>
                                    </div>
                                </div>

                                <!-- å­¦ä¹ æ•ˆç‡æŒ‡ç¤ºå™¨ -->
                                <div class="mb-2 p-2 rounded text-center"
                                    style="background-color: rgba(13, 110, 253, 0.08); border: 1px solid rgba(13, 110, 253, 0.2);">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span class="text-muted" style="font-size: 0.8rem;">ğŸ“Š å­¦ä¹ æ•ˆç‡</span>
                                        <span id="efficiency-value" class="fw-bold text-primary">100%</span>
                                    </div>
                                    <div class="small text-muted" id="efficiency-hint"
                                        style="font-size: 0.7rem; margin-top: 2px;">
                                        çŠ¶æ€è‰¯å¥½
                                    </div>
                                </div>

                                <hr class="my-2">

                                <!-- ç²¾ç®€å±æ€§æ˜¾ç¤º -->
                                <div class="d-flex justify-content-around align-items-center py-2"
                                    style="font-size: 0.9rem;">
                                    <span data-bs-toggle="tooltip" data-bs-placement="top" title="æ™ºå•†"
                                        class="text-center">
                                        <span style="font-size: 1.2rem;">ğŸ§ </span><br>
                                        <small id="val-iq" class="fw-bold">--</small>
                                    </span>
                                    <span data-bs-toggle="tooltip" data-bs-placement="top" title="æƒ…å•†"
                                        class="text-center">
                                        <span style="font-size: 1.2rem;">ğŸ’¬</span><br>
                                        <small id="val-eq" class="fw-bold">--</small>
                                    </span>
                                    <span data-bs-toggle="tooltip" data-bs-placement="top" title="è¿æ°”"
                                        class="text-center">
                                        <span style="font-size: 1.2rem;">ğŸ€</span><br>
                                        <small id="val-luck" class="fw-bold">--</small>
                                    </span>
                                    <span data-bs-toggle="tooltip" data-bs-placement="top" title="é£è¯„"
                                        class="text-center">
                                        <span style="font-size: 1.2rem;">â­</span><br>
                                        <small id="val-reputation" class="fw-bold">0</small>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- æ‘¸é±¼ä¼‘é—²é¢æ¿ -->
                    <div class="accordion-item border-0 mb-2">
                        <h2 class="accordion-header" id="headingRelax">
                            <button class="accordion-button collapsed bg-warning text-dark py-2" type="button"
                                data-bs-toggle="collapse" data-bs-target="#collapseRelax" aria-expanded="false"
                                aria-controls="collapseRelax">
                                <strong>â˜• æ‘¸é±¼ä¼‘é—²</strong>
                            </button>
                        </h2>
                        <div id="collapseRelax" class="accordion-collapse collapse" aria-labelledby="headingRelax">
                            <div class="accordion-body p-3">
                                <div class="d-grid gap-2">
                                    <button id="btn-gym" class="btn btn-sm btn-outline-primary"
                                        onclick="sendAction('relax', 'gym')">ğŸ‹ï¸â€â™‚ï¸ å¥èº«æˆ¿</button>
                                    <button id="btn-game" class="btn btn-sm btn-outline-success"
                                        onclick="sendAction('relax', 'game')">ğŸ® æ‰“æ¸¸æˆ</button>
                                    <button id="btn-cc98" class="btn btn-sm btn-outline-info"
                                        onclick="sendAction('relax', 'cc98')">ğŸŒŠ åˆ·CC98</button>
                                    <button id="btn-walk" class="btn btn-sm btn-outline-secondary"
                                        onclick="sendAction('relax', 'walk')">ğŸš¶ æ•£æ­¥å¯çœŸæ¹–</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- è€ƒè¯•æ§åˆ¶å°é¢æ¿ -->
                    <div class="accordion-item border-0 mb-2">
                        <h2 class="accordion-header" id="headingExam">
                            <button class="accordion-button bg-danger text-white py-2" type="button"
                                data-bs-toggle="collapse" data-bs-target="#collapseExam" aria-expanded="true"
                                aria-controls="collapseExam">
                                <strong>ğŸ”¥ å­¦æœŸè¿›åº¦</strong>
                            </button>
                        </h2>
                        <div id="collapseExam" class="accordion-collapse collapse show" aria-labelledby="headingExam">
                            <div class="accordion-body p-0">
                                <div id="exam-console-container"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
            <script src="/static/js/config.js?v=20260211"></script>
            <script type="module" src="/static/js/main.js?v=20260211"></script>

            <div class="modal fade" id="summaryModal" tabindex="-1" data-bs-backdrop="static">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header bg-primary text-white">
                            <h5 class="modal-title">ğŸ“„ å­¦æœŸæˆç»©å•</h5>
                        </div>
                        <div class="modal-body">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>è¯¾ç¨‹</th>
                                        <th>æˆç»©</th>
                                        <th>ç»©ç‚¹</th>
                                    </tr>
                                </thead>
                                <tbody id="transcript-body"></tbody>
                            </table>
                            <div class="alert alert-info text-center">
                                æœ¬å­¦æœŸ GPA: <strong id="transcript-gpa" class="fs-4">0.0</strong>
                            </div>
                            <div id="transcript-msg" class="text-center text-muted mb-2"></div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-primary" onclick="nextSemester()">è¿›å…¥ä¸‹ä¸€å­¦å¹´</button>
                        </div>
                    </div>
                </div>
            </div>
</body>

</html>